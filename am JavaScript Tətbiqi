// Test TapÅŸÄ±rÄ±qlarÄ± FormatlarÄ± - Tam JavaScript TÉ™tbiqi

// Test suallarÄ± mÉ™lumat bazasÄ±
const testQuestions = {
    multiple_choice: {
        question_id: 1,
        title: "ğŸ”˜ Ã‡oxlu SeÃ§im SualÄ±",
        question_text: "2x + 8 = 20 tÉ™nliyinin hÉ™lli nÉ™dir?",
        question_type: "multiple_choice",
        options: {
            "x = 4": "A",
            "x = 6": "B", 
            "x = 8": "C",
            "x = 12": "D"
        },
        correct_answer: "B",
        difficulty_level: 2,
        topic: "TÉ™nliklÉ™r",
        time_limit: 60,
        explanation: "2x + 8 = 20 â†’ 2x = 12 â†’ x = 6",
        usage_percent: 45
    },
    
    multiple_response: {
        question_id: 2,
        title: "â˜‘ï¸ Ã‡oxlu Cavab SualÄ±",
        question_text: "AÅŸaÄŸÄ±dakÄ± hansÄ± É™dÉ™dlÉ™r irrational É™dÉ™dlÉ™rdir? (BirdÉ™n Ã§ox seÃ§im mÃ¼mkÃ¼ndÃ¼r)",
        question_type: "multiple_response",
        options: {
            "âˆš2": "A",
            "Ï€ (pi)": "B",
            "3.14": "C",
            "âˆš9": "D",
            "e (Euler É™dÉ™di)": "E"
        },
        correct_answers: ["A", "B", "E"],
        difficulty_level: 3,
        topic: "ÆdÉ™dlÉ™r",
        time_limit: 90,
        explanation: "âˆš2, Ï€ vÉ™ e irrational É™dÉ™dlÉ™rdir. 3.14 vÉ™ âˆš9=3 rational É™dÉ™dlÉ™rdir.",
        usage_percent: 20
    },
    
    true_false: {
        question_id: 3,
        title: "âœ“/âœ— DoÄŸru/YanlÄ±ÅŸ SualÄ±",
        question_text: "Kvadrat kÃ¶klÉ™r hÉ™miÅŸÉ™ mÃ¼sbÉ™t É™dÉ™dlÉ™r verir",
        question_type: "true_false",
        correct_answer: true,
        difficulty_level: 1,
        topic: "KÃ¶k É™mÉ™liyyatlarÄ±",
        time_limit: 30,
        explanation: "BÉ™li, riyaziyyatda kvadrat kÃ¶k simvolu (âˆš) hÉ™miÅŸÉ™ mÃ¼sbÉ™t nÉ™ticÉ™ verir",
        usage_percent: 15
    },
    
    open_ended: {
        question_id: 4,
        title: "ğŸ“ AÃ§Ä±q CavablÄ± Sual",
        question_text: "Kvadrat tÉ™nliyin diskriminant dÃ¼sturunu yazÄ±n vÉ™ onun mÉ™nasÄ±nÄ± izah edin.",
        question_type: "open_ended",
        expected_keywords: ["diskriminant", "D", "bÂ²-4ac", "kÃ¶k", "hÉ™ll", "tÉ™nlik"],
        max_score: 10,
        difficulty_level: 3,
        topic: "Kvadrat tÉ™nliklÉ™r",
        time_limit: 300,
        sample_answer: "Diskriminant D = bÂ²-4ac dÃ¼sturu ilÉ™ hesablanÄ±r. ÆgÉ™r D>0 iki fÉ™rqli hÉ™ll, D=0 bir hÉ™ll, D<0 hÉ™ll yoxdur.",
        usage_percent: 10
    },
    
    fill_blanks: {
        question_id: 5,
        title: "ğŸ“„ BoÅŸluqlarÄ± Doldurun",
        question_text: "SinÂ²x + CosÂ²x = ___ vÉ™ tg(45Â°) = ___",
        question_type: "fill_blanks",
        blanks: {
            blank1: {correct: "1", alternatives: ["1", "bir"]},
            blank2: {correct: "1", alternatives: ["1", "bir"]}
        },
        difficulty_level: 2,
        topic: "Trigonometriya",
        time_limit: 45,
        explanation: "SinÂ²x + CosÂ²x = 1 (É™sas trigonometrik dÃ¼stur), tg(45Â°) = 1",
        usage_percent: 5
    },
    
    matching: {
        question_id: 6,
        title: "ğŸ”— UyÄŸunlaÅŸdÄ±rma SualÄ±",
        question_text: "Sol vÉ™ saÄŸ sÃ¼tunlarÄ± uyÄŸunlaÅŸdÄ±rÄ±n:",
        question_type: "matching",
        left_items: {
            "1": "Sin(30Â°)",
            "2": "Cos(60Â°)", 
            "3": "Tg(45Â°)",
            "4": "Sin(90Â°)"
        },
        right_items: {
            "A": "1",
            "B": "1/2",
            "C": "âˆš3/2",
            "D": "0"
        },
        correct_matches: {"1": "B", "2": "B", "3": "A", "4": "A"},
        difficulty_level: 3,
        topic: "Trigonometriya",
        time_limit: 120,
        usage_percent: 3
    },
    
    ordering: {
        question_id: 7,
        title: "ğŸ”¢ SÄ±ralama SualÄ±",
        question_text: "AÅŸaÄŸÄ±dakÄ± É™dÉ™dlÉ™ri kiÃ§ikdÉ™n bÃ¶yÃ¼yÉ™ doÄŸru dÃ¼zÃ¼n:",
        question_type: "ordering",
        items: {
            "A": "âˆš16",
            "B": "Ï€",
            "C": "2.5",
            "D": "3Â²/2",
            "E": "âˆš5"
        },
        correct_order: ["E", "C", "B", "A", "D"], // âˆš5â‰ˆ2.24, 2.5, Ï€â‰ˆ3.14, 4, 4.5
        difficulty_level: 4,
        topic: "ÆdÉ™dlÉ™rin mÃ¼qayisÉ™si",
        time_limit: 90,
        explanation: "âˆš5â‰ˆ2.24 < 2.5 < Ï€â‰ˆ3.14 < âˆš16=4 < 3Â²/2=4.5",
        usage_percent: 2
    }
};

// Global dÉ™yiÅŸÉ™nlÉ™r
let currentQuestion = null;
let testResults = [];
let timerInterval = null;
let remainingTime = 0;
let timerActive = false;
let testStarted = false;

// DOM yÃ¼klÉ™nÉ™ndÉ™n sonra baÅŸlat
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
    loadFormatDemos();
    setupEventListeners();
    updateStatistics();
});

// TÉ™tbiqi baÅŸlat
function initializeApp() {
    showTab('formats');
    updateStatistics();
    loadResultsTable();
}

// Event listener-lÉ™ri qur
function setupEventListeners() {
    // Tab navigasiyasÄ±
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const tabName = this.getAttribute('data-tab');
            showTab(tabName);
        });
    });

    // Test baÅŸlatma
    document.getElementById('start-test')?.addEventListener('click', startTest);
    
    // Cavab tÉ™sdiqlÉ™nmÉ™si
    document.getElementById('submit-answer')?.addEventListener('click', submitAnswer);
    
    // NÃ¶vbÉ™ti sual
    document.getElementById('next-question')?.addEventListener('click', nextQuestion);
    
    // NÉ™ticÉ™lÉ™ri yÃ¼klÉ™mÉ™
    document.getElementById('download-results')?.addEventListener('click', downloadResults);
    
    // TestÉ™ keÃ§id
    document.getElementById('go-to-test')?.addEventListener('click', () => showTab('interactive'));
}

// Tab gÃ¶stÉ™rme
function showTab(tabName) {
    // BÃ¼tÃ¼n tab-larÄ± gizlÉ™t
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // SeÃ§ilmiÅŸ tab-Ä± gÃ¶stÉ™r
    const targetTab = document.getElementById(tabName + '-tab');
    if (targetTab) {
        targetTab.style.display = 'block';
    }
    
    // Navigation link-lÉ™ri yenilÉ™
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
    });
    
    const activeLink = document.querySelector(`[data-tab="${tabName}"]`);
    if (activeLink) {
        activeLink.classList.add('active');
    }
    
    // Tab-a gÃ¶rÉ™ mÉ™zmunu yenilÉ™
    if (tabName === 'results') {
        loadResultsTable();
        updateValueBoxes();
    } else if (tabName === 'statistics') {
        updateStatistics();
    }
}

// Format demo-larÄ±nÄ± yÃ¼klÉ™
function loadFormatDemos() {
    const container = document.getElementById('format-demos');
    if (!container) return;
    
    container.innerHTML = '';
    
    Object.keys(testQuestions).forEach(formatKey => {
        const question = testQuestions[formatKey];
        const demoCard = createFormatDemo(question, formatKey);
        container.appendChild(demoCard);
    });
}

// Format demo kartÄ± yarat
function createFormatDemo(question, formatKey) {
    const card = document.createElement('div');
    card.className = 'format-card';
    
    const progressBar = `
        <div class="progress-container">
            <div class="progress-bar" style="width: ${question.usage_percent}%">
                Ä°stifadÉ™: ${question.usage_percent}%
            </div>
        </div>
    `;
    
    let inputHTML = '';
    let correctAnswerHTML = '';
    
    // Format tipinÉ™ gÃ¶rÉ™ input vÉ™ cavab gÃ¶stÉ™r
    switch(question.question_type) {
        case 'multiple_choice':
            inputHTML = createMultipleChoiceInput(question, formatKey);
            const correctText = Object.keys(question.options).find(key => question.options[key] === question.correct_answer);
            correctAnswerHTML = `<div class="correct-answer">âœ“ DÃ¼zgÃ¼n cavab: ${correctText}</div>`;
            break;
            
        case 'multiple_response':
            inputHTML = createMultipleResponseInput(question, formatKey);
            const correctTexts = question.correct_answers.map(ans => 
                Object.keys(question.options).find(key => question.options[key] === ans)
            ).join(', ');
            correctAnswerHTML = `<div class="correct-answer">âœ“ DÃ¼zgÃ¼n cavablar: ${correctTexts}</div>`;
            break;
            
        case 'true_false':
            inputHTML = createTrueFalseInput(question, formatKey);
            correctAnswerHTML = `<div class="correct-answer">âœ“ DÃ¼zgÃ¼n cavab: ${question.correct_answer ? 'DoÄŸru' : 'YanlÄ±ÅŸ'}</div>`;
            break;
            
        case 'open_ended':
            inputHTML = createOpenEndedInput(question, formatKey);
            correctAnswerHTML = `<div class="correct-answer">âœ“ NÃ¼munÉ™: ${question.sample_answer.substring(0, 50)}...</div>`;
            break;
            
        case 'fill_blanks':
            inputHTML = createFillBlanksInput(question, formatKey);
            correctAnswerHTML = `<div class="correct-answer">âœ“ DÃ¼zgÃ¼n cavablar: 1, 1</div>`;
            break;
            
        case 'matching':
            inputHTML = createMatchingInput(question, formatKey);
            correctAnswerHTML = `<div class="correct-answer">âœ“ DÃ¼zgÃ¼n uyÄŸunluq: 1-B, 2-B, 3-A, 4-A</div>`;
            break;
            
        case 'ordering':
            inputHTML = createOrderingInput(question, formatKey);
            correctAnswerHTML = `<div class="correct-answer">âœ“ DÃ¼zgÃ¼n sÄ±ra: ${question.correct_order.join(' < ')}</div>`;
            break;
    }
    
    card.innerHTML = `
        <div class="card-header">
            <h3>${question.title}</h3>
        </div>
        <div class="card-body">
            <h4>${question.question_text}</h4>
            ${progressBar}
            <hr>
            ${inputHTML}
            ${correctAnswerHTML}
            <hr>
            <div class="question-meta">
                <p><strong>ğŸ“Š Ã‡É™tinlik:</strong> ${'â­'.repeat(question.difficulty_level)} (${question.difficulty_level}/5)</p>
                <p><strong>ğŸ“š MÃ¶vzu:</strong> ${question.topic}</p>
                <p><strong>â±ï¸ Vaxt:</strong> ${question.time_limit} saniyÉ™</p>
                ${question.explanation ? `<p><strong>ğŸ’¡ Ä°zah:</strong> ${question.explanation}</p>` : ''}
            </div>
        </div>
    `;
    
    return card;
}

// Multiple choice input yaradÄ±r
function createMultipleChoiceInput(question, formatKey) {
    let html = '<div class="radio-group">';
    Object.keys(question.options).forEach(optionText => {
        const value = question.options[optionText];
        html += `
            <label class="radio-option">
                <input type="radio" name="demo_${formatKey}" value="${value}">
                <span class="radio-text">${optionText}</span>
            </label>
        `;
    });
    html += '</div>';
    return html;
}

// Multiple response input yaradÄ±r
function createMultipleResponseInput(question, formatKey) {
    let html = '<div class="checkbox-group">';
    Object.keys(question.options).forEach(optionText => {
        const value = question.options[optionText];
        html += `
            <label class="checkbox-option">
                <input type="checkbox" name="demo_${formatKey}" value="${value}">
                <span class="checkbox-text">${optionText}</span>
            </label>
        `;
    });
    html += '</div>';
    return html;
}

// True/False input yaradÄ±r
function createTrueFalseInput(question, formatKey) {
    return `
        <div class="radio-group">
            <label class="radio-option">
                <input type="radio" name="demo_${formatKey}" value="true">
                <span class="radio-text">DoÄŸru</span>
            </label>
            <label class="radio-option">
                <input type="radio" name="demo_${formatKey}" value="false">
                <span class="radio-text">YanlÄ±ÅŸ</span>
            </label>
        </div>
    `;
}

// Open ended input yaradÄ±r
function createOpenEndedInput(question, formatKey) {
    return `
        <textarea id="demo_${formatKey}" placeholder="CavabÄ±nÄ±zÄ± buraya yazÄ±n..." rows="3" class="text-input"></textarea>
    `;
}

// Fill blanks input yaradÄ±r
function createFillBlanksInput(question, formatKey) {
    return `
        <div class="fill-blanks-container">
            <div class="blank-row">
                <label>Birinci boÅŸluq:</label>
                <input type="text" id="demo_${formatKey}_1" placeholder="1-ci boÅŸluq" class="blank-input">
            </div>
            <div class="blank-row">
                <label>Ä°kinci boÅŸluq:</label>
                <input type="text" id="demo_${formatKey}_2" placeholder="2-ci boÅŸluq" class="blank-input">
            </div>
        </div>
    `;
}

// Matching input yaradÄ±r
function createMatchingInput(question, formatKey) {
    let leftColumn = '<h5>Sol sÃ¼tun:</h5>';
    Object.keys(question.left_items).forEach(key => {
        leftColumn += `<div class="match-item">${key}: ${question.left_items[key]}</div>`;
    });
    
    let rightColumn = '<h5>SaÄŸ sÃ¼tun:</h5>';
    Object.keys(question.right_items).forEach(key => {
        rightColumn += `<div class="match-item">${key}: ${question.right_items[key]}</div>`;
    });
    
    return `
        <div class="matching-container">
            <div class="match-column">${leftColumn}</div>
            <div class="match-column">${rightColumn}</div>
        </div>
    `;
}

// Ordering input yaradÄ±r
function createOrderingInput(question, formatKey) {
    let itemsHTML = '';
    Object.keys(question.items).forEach(key => {
        itemsHTML += `<span class="order-item">${key}: ${question.items[key]}</span>`;
    });
    
    return `
        <p>VerilÉ™n É™dÉ™dlÉ™ri kiÃ§ikdÉ™n bÃ¶yÃ¼yÉ™ sÄ±ralayÄ±n:</p>
        <div class="ordering-items">${itemsHTML}</div>
    `;
}

// Test baÅŸlat
function startTest() {
    const selectedFormat = document.getElementById('selected-format').value;
    if (!selectedFormat || !testQuestions[selectedFormat]) {
        showNotification('âš ï¸ ZÉ™hmÉ™t olmasa test formatÄ±nÄ± seÃ§in!', 'warning');
        return;
    }
    
    currentQuestion = testQuestions[selectedFormat];
    remainingTime = currentQuestion.time_limit;
    timerActive = true;
    testStarted = true;
    
    updateTestInfo();
    createCurrentQuestionUI();
    startTimer();
    
    showNotification('ğŸš€ Test baÅŸladÄ±! UÄŸurlar!', 'success');
}

// Timer baÅŸlat
function startTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    timerInterval = setInterval(() => {
        if (timerActive && remainingTime > 0) {
            remainingTime--;
            updateTimerDisplay();
            
            if (remainingTime <= 0) {
                timerActive = false;
                showNotification('â° Vaxt bitdi!', 'warning');
                clearInterval(timerInterval);
            }
        }
    }, 1000);
}

// Timer gÃ¶rÃ¼nÃ¼ÅŸÃ¼nÃ¼ yenilÉ™
function updateTimerDisplay() {
    const minutes = Math.floor(remainingTime / 60);
    const seconds = remainingTime % 60;
    const timeText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    const timerElement = document.getElementById('timer-text');
    if (timerElement) {
        if (remainingTime <= 30 && remainingTime > 0) {
            timerElement.textContent = `âš ï¸ ${timeText}`;
            timerElement.style.color = '#dc3545';
        } else {
            timerElement.textContent = timeText;
            timerElement.style.color = '#fd7e14';
        }
    }
}

// Test mÉ™lumatlarÄ±nÄ± yenilÉ™
function updateTestInfo() {
    const testInfoElement = document.getElementById('test-info');
    if (!testInfoElement) return;
    
    if (currentQuestion) {
        testInfoElement.innerHTML = `
            <p><strong>ğŸ“‹ Format:</strong> ${currentQuestion.title}</p>
            <p><strong>ğŸ“š MÃ¶vzu:</strong> ${currentQuestion.topic}</p>
            <p><strong>â­ Ã‡É™tinlik:</strong> ${currentQuestion.difficulty_level}/5</p>
            <p><strong>ğŸ¯ Sual ID:</strong> ${currentQuestion.question_id}</p>
            <p><strong>â±ï¸ Vaxt limiti:</strong> ${currentQuestion.time_limit} saniyÉ™</p>
        `;
    } else {
        testInfoElement.innerHTML = `
            <p>Test seÃ§ilmÉ™yib.</p>
            <p>YuxarÄ±dan format seÃ§ib 'Testi BaÅŸlat' dÃ¼ymÉ™sini basÄ±n.</p>
        `;
    }
    
    // Timer status yenilÉ™
    const statusElement = document.getElementById('timer-status');
    if (statusElement) {
        if (timerActive) {
            statusElement.textContent = 'ğŸŸ¢ Timer aktiv';
        } else if (testStarted) {
            statusElement.textContent = 'ğŸ”´ Vaxt bitdi';
        } else {
            statusElement.textContent = 'âšª Test baÅŸlamayÄ±b';
        }
    }
}

// HazÄ±rki sual UI yaratÄ±r
function createCurrentQuestionUI() {
    const container = document.getElementById('current-question');
    if (!container || !currentQuestion) return;
    
    let inputHTML = '';
    
    switch(currentQuestion.question_type) {
        case 'multiple_choice':
            inputHTML = createCurrentMultipleChoice();
            break;
        case 'multiple_response':
            inputHTML = createCurrentMultipleResponse();
            break;
        case 'true_false':
            inputHTML = createCurrentTrueFalse();
            break;
        case 'open_ended':
            inputHTML = createCurrentOpenEnded();
            break;
        case 'fill_blanks':
            inputHTML = createCurrentFillBlanks();
            break;
        case 'matching':
            inputHTML = createCurrentMatching();
            break;
        case 'ordering':
            inputHTML = createCurrentOrdering();
            break;
    }
    
    container.innerHTML = `
        <h3>ğŸ“ Sual ${currentQuestion.question_id}: ${currentQuestion.question_text}</h3>
        ${inputHTML}
    `;
    
    container.style.display = 'block';
}

// HazÄ±rki multiple choice yaradÄ±r
function createCurrentMultipleChoice() {
    let html = '<div class="question-options">';
    Object.keys(currentQuestion.options).forEach(optionText => {
        const value = currentQuestion.options[optionText];
        html += `
            <label class="option-label">
                <input type="radio" name="current_answer" value="${value}">
                <span>${optionText}</span>
            </label>
        `;
    });
    html += '</div>';
    return html;
}

// HazÄ±rki multiple response yaradÄ±r
function createCurrentMultipleResponse() {
    let html = '<div class="question-options">';
    Object.keys(currentQuestion.options).forEach(optionText => {
        const value = currentQuestion.options[optionText];
        html += `
            <label class="option-label">
                <input type="checkbox" name="current_answer" value="${value}">
                <span>${optionText}</span>
            </label>
        `;
    });
    html += '</div>';
    return html;
}

// HazÄ±rki true/false yaradÄ±r
function createCurrentTrueFalse() {
    return `
        <div class="question-options">
            <label class="option-label">
                <input type="radio" name="current_answer" value="true">
                <span>âœ“ DoÄŸru</span>
            </label>
            <label class="option-label">
                <input type="radio" name="current_answer" value="false">
                <span>âœ— YanlÄ±ÅŸ</span>
            </label>
        </div>
    `;
}

// HazÄ±rki open ended yaradÄ±r
function createCurrentOpenEnded() {
    return `
        <div class="question-input">
            <label>CavabÄ±nÄ±zÄ± yazÄ±n:</label>
            <textarea id="current_answer" placeholder="ÆtraflÄ± cavabÄ±nÄ±zÄ± buraya yazÄ±n..." rows="5"></textarea>
        </div>
    `;
}

// HazÄ±rki fill blanks yaradÄ±r
function createCurrentFillBlanks() {
    return `
        <div class="fill-blanks-current">
            <h5>BoÅŸluqlarÄ± doldurun:</h5>
            <p>SinÂ²x + CosÂ²x = ___ vÉ™ tg(45Â°) = ___</p>
            <div class="blanks-row">
                <div class="blank-input-group">
                    <label>Birinci boÅŸluq (SinÂ²x + CosÂ²x = ?):</label>
                    <input type="text" id="blank1" placeholder="CavabÄ± buraya yazÄ±n">
                </div>
                <div class="blank-input-group">
                    <label>Ä°kinci boÅŸluq (tg(45Â°) = ?):</label>
                    <input type="text" id="blank2" placeholder="CavabÄ± buraya yazÄ±n">
                </div>
            </div>
        </div>
    `;
}

// HazÄ±rki matching yaradÄ±r
function createCurrentMatching() {
    let leftColumn = '<h6>Sol sÃ¼tun:</h6><div class="match-items">';
    Object.keys(currentQuestion.left_items).forEach(key => {
        leftColumn += `<div class="match-item-current">${key}: ${currentQuestion.left_items[key]}</div>`;
    });
    leftColumn += '</div>';
    
    let rightColumn = '<h6>SaÄŸ sÃ¼tun:</h6><div class="match-items">';
    Object.keys(currentQuestion.right_items).forEach(key => {
        rightColumn += `<div class="match-item-current">${key}: ${currentQuestion.right_items[key]}</div>`;
    });
    rightColumn += '</div>';
    
    return `
        <div class="matching-current">
            <h5>Sol vÉ™ saÄŸ sÃ¼tunlarÄ± uyÄŸunlaÅŸdÄ±rÄ±n:</h5>
            <div class="match-columns">
                <div class="match-column">${leftColumn}</div>
                <div class="match-column">${rightColumn}</div>
            </div>
            <div class="match-input">
                <label>UyÄŸunluqlarÄ± yazÄ±n (mÉ™sÉ™lÉ™n: 1-B, 2-A, 3-C, 4-D):</label>
                <textarea id="current_answer" placeholder="CavabÄ±nÄ±zÄ± '1-B, 2-A, 3-C, 4-D' formatÄ±nda yazÄ±n" rows="3"></textarea>
            </div>
        </div>
    `;
}

// HazÄ±rki ordering yaradÄ±r
function createCurrentOrdering() {
    let itemsHTML = '';
    Object.keys(currentQuestion.items).forEach(key => {
        itemsHTML += `<span class="order-item-current">${key}: ${currentQuestion.items[key]}</span>`;
    });
    
    return `
        <div class="ordering-current">
            <h5>AÅŸaÄŸÄ±dakÄ± É™dÉ™dlÉ™ri kiÃ§ikdÉ™n bÃ¶yÃ¼yÉ™ sÄ±ralayÄ±n:</h5>
            <div class="ordering-items-current">${itemsHTML}</div>
            <div class="order-input">
                <label>SÄ±ralamanÄ± yazÄ±n (mÉ™sÉ™lÉ™n: E, C, B, A, D):</label>
                <textarea id="current_answer" placeholder="HÉ™rf sÄ±rasÄ±nÄ± kiÃ§ikdÉ™n bÃ¶yÃ¼yÉ™ yazÄ±n: E, C, B, A, D" rows="2"></textarea>
            </div>
        </div>
    `;
}

// CavabÄ± tÉ™sdiqlÉ™
function submitAnswer() {
    if (!currentQuestion) {
        showNotification('âš ï¸ Aktiv sual yoxdur!', 'warning');
        return;
    }
    
    let userAnswer = getCurrentAnswer();
    
    if (!userAnswer || userAnswer.length === 0) {
        showNotification('âš ï¸ ZÉ™hmÉ™t olmasa cavab verin!', 'warning');
        return;
    }
    
    // QiymÉ™tlÉ™ndirmÉ™
    const result = evaluateAnswer(currentQuestion, userAnswer);
    
    // NÉ™ticÉ™ni saxla
    const newResult = {
        question_id: currentQuestion.question_id,
        question_text: currentQuestion.question_text.substring(0, 50),
        question_type: currentQuestion.question_type,
        topic: currentQuestion.topic,
        difficulty: currentQuestion.difficulty_level,
        user_answer: Array.isArray(userAnswer) ? userAnswer.join(', ') : userAnswer,
        correct_answer: getCorrectAnswerText(currentQuestion),
        is_correct: result.is_correct,
        score: result.score,
        max_score: currentQuestion.question_type === 'open_ended' ? currentQuestion.max_score : 1,
        response_time: currentQuestion.time_limit - remainingTime,
        timestamp: new Date().toISOString()
    };
    
    testResults.push(newResult);
    timerActive = false;
    clearInterval(timerInterval);
    
    // Feedback gÃ¶stÉ™r
    showAnswerFeedback(result, userAnswer);
    
    // BildiriÅŸ gÃ¶stÉ™r
    showNotification(
        result.is_correct ? 'ğŸ‰ TÉ™briklÉ™r! DoÄŸru cavab!' : 'ğŸ˜ YanlÄ±ÅŸ cavab, ancaq tÉ™crÃ¼bÉ™ qazandÄ±nÄ±z!',
        result.is_correct ? 'success' : 'warning'
    );
}

// HazÄ±rki cavabÄ± al
function getCurrentAnswer() {
    if (!currentQuestion) return null;
    
    switch(currentQuestion.question_type) {
        case 'multiple_choice':
        case 'true_false':
            const radioInput = document.querySelector('input[name="current_answer"]:checked');
            return radioInput ? radioInput.value : null;
            
        case 'multiple_response':
            const checkboxInputs = document.querySelectorAll('input[name="current_answer"]:checked');
            return Array.from(checkboxInputs).map(input => input.value);
            
        case 'open_ended':
        case 'matching':
        case 'ordering':
            const textInput = document.getElementById('current_answer');
            return textInput ? textInput.value.trim() : null;
            
        case 'fill_blanks':
            const blank1 = document.getElementById('blank1');
            const blank2 = document.getElementById('blank2');
            return [blank1 ? blank1.value.trim() : '', blank2 ? blank2.value.trim() : ''];
            
        default:
            return null;
    }
}

// CavabÄ± qiymÉ™tlÉ™ndir
function evaluateAnswer(question, userAnswer) {
    // ÆgÉ™r cavab boÅŸdursa
    if (!userAnswer || userAnswer.length === 0 || 
        (typeof userAnswer === 'string' && userAnswer.trim() === '')) {
        return {
            is_correct: false,
            score: 0,
            correct_info: "Cavab verilmÉ™yib"
        };
    }
    
    switch(question.question_type) {
        case 'multiple_choice':
            const isCorrect = userAnswer === question.correct_answer;
            const correctText = Object.keys(question.options).find(key => 
                question.options[key] === question.correct_answer
            );
            return {
                is_correct: isCorrect,
                score: isCorrect ? 1 : 0,
                correct_info: correctText || question.correct_answer
            };
            
        case 'multiple_response':
            const isFullyCorrect = question.correct_answers.length === userAnswer.length && 
                                   question.correct_answers.every(ans => userAnswer.includes(ans));
            const partialScore = userAnswer.filter(ans => 
                question.correct_answers.includes(ans)
            ).length / question.correct_answers.length;
            
            const correctTexts = question.correct_answers.map(ans => 
                Object.keys(question.options).find(key => question.options[key] === ans)
            ).join(', ');
            
            return {
                is_correct: isFullyCorrect,
                score: isFullyCorrect ? 1 : Math.round(partialScore * 100) / 100,
                correct_info: correctTexts
            };
            
        case 'true_false':
            const boolAnswer = userAnswer === 'true';
            const correctBool = boolAnswer === question.correct_answer;
            return {
                is_correct: correctBool,
                score: correctBool ? 1 : 0,
                correct_info: question.correct_answer ? 'DoÄŸru' : 'YanlÄ±ÅŸ'
            };
            
        case 'open_ended':
            const userText = typeof userAnswer === 'string' ? userAnswer.toLowerCase() : '';
            const keywordsFound = question.expected_keywords.filter(keyword => 
                userText.includes(keyword.toLowerCase())
            ).length;
            
            const score = (keywordsFound / question.expected_keywords.length) * question.max_score;
            
            return {
                is_correct: score >= question.max_score * 0.6,
                score: Math.round(score * 10) / 10,
                correct_info: question.sample_answer
            };
            
        case 'fill_blanks':
            let correctCount = 0;
            if (Array.isArray(userAnswer) && userAnswer.length >= 2) {
                // HÉ™r iki boÅŸluq Ã¼Ã§Ã¼n "1" olub-olmadÄ±ÄŸÄ±nÄ± yoxla
                if (userAnswer[0].toLowerCase().includes('1') || userAnswer[0].toLowerCase().includes('bir')) {
                    correctCount++;
                }
                if (userAnswer[1].toLowerCase().includes('1') || userAnswer[1].toLowerCase().includes('bir')) {
                    correctCount++;
                }
            }
            
            return {
                is_correct: correctCount === 2,
                score: correctCount * 0.5,
                correct_info: "SinÂ²x + CosÂ²x = 1 vÉ™ tg(45Â°) = 1"
            };
            
        case 'matching':
            const userText = typeof userAnswer === 'string' ? userAnswer : '';
            const userMatches = userText.split(/[,;]/).map(match => match.trim());
            let correctMatches = 0;
            const totalMatches = Object.keys(question.correct_matches).length;
            
            userMatches.forEach(match => {
                if (match.includes('-')) {
                    const [left, right] = match.split('-').map(part => part.trim());
                    if (question.correct_matches[left] === right) {
                        correctMatches++;
                    }
                }
            });
            
            const matchScore = totalMatches > 0 ? correctMatches / totalMatches : 0;
            const correctInfo = Object.keys(question.correct_matches).map(key => 
                `${key}-${question.correct_matches[key]}`
            ).join(', ');
            
            return {
                is_correct: matchScore >= 0.8,
                score: Math.round(matchScore * 100) / 100,
                correct_info: correctInfo
            };
            
        case 'ordering':
            const userText2 = typeof userAnswer === 'string' ? userAnswer : '';
            const userOrder = userText2.split(/[,;]/).map(item => item.trim()).filter(item => item);
            
            const isOrderCorrect = JSON.stringify(userOrder) === JSON.stringify(question.correct_order);
            
            // QismÉ™n bal - neÃ§É™ element dÃ¼zgÃ¼n yerdÉ™dir
            let partialOrderScore = 0;
            if (userOrder.length === question.correct_order.length) {
                for (let i = 0; i < userOrder.length; i++) {
                    if (userOrder[i] === question.correct_order[i]) {
                        partialOrderScore++;
                    }
                }
                partialOrderScore = partialOrderScore / question.correct_order.length;
            }
            
            return {
                is_correct: isOrderCorrect,
                score: isOrderCorrect ? 1 : Math.round(partialOrderScore * 100) / 100,
                correct_info: question.correct_order.join(' < ')
            };
            
        default:
            return {
                is_correct: false,
                score: 0,
                correct_info: "Format dÉ™stÉ™klÉ™nmir"
            };
    }
}

// DÃ¼zgÃ¼n cavab mÉ™tnini al
function getCorrectAnswerText(question) {
    switch(question.question_type) {
        case 'multiple_choice':
            return Object.keys(question.options).find(key => 
                question.options[key] === question.correct_answer
            ) || question.correct_answer;
            
        case 'multiple_response':
            return question.correct_answers.map(ans => 
                Object.keys(question.options).find(key => question.options[key] === ans)
            ).join(', ');
            
        case 'true_false':
            return question.correct_answer ? 'DoÄŸru' : 'YanlÄ±ÅŸ';
            
        case 'open_ended':
            return question.sample_answer.substring(0, 50) + '...';
            
        case 'fill_blanks':
            return "SinÂ²x + CosÂ²x = 1, tg(45Â°) = 1";
            
        case 'matching':
            return Object.keys(question.correct_matches).map(key => 
                `${key}-${question.correct_matches[key]}`
            ).join(', ');
            
        case 'ordering':
            return question.correct_order.join(' < ');
            
        default:
            return 'NamÉ™lum';
    }
}

// Cavab feedback-ini gÃ¶stÉ™r
function showAnswerFeedback(result, userAnswer) {
    const feedbackContainer = document.getElementById('answer-feedback');
    if (!feedbackContainer) return;
    
    const feedbackHTML = `
        <div class="feedback-box ${result.is_correct ? 'feedback-correct' : 'feedback-incorrect'}">
            <h4>${result.is_correct ? 'ğŸ‰ Æla! DoÄŸru cavab!' : 'ğŸ˜” TÉ™É™ssÃ¼f, yanlÄ±ÅŸ cavab'}</h4>
            <div class="feedback-details">
                <p><strong>Sizin cavabÄ±nÄ±z:</strong> ${Array.isArray(userAnswer) ? userAnswer.join(', ') : userAnswer}</p>
                <p><strong>DÃ¼zgÃ¼n cavab:</strong> ${result.correct_info}</p>
                <p><strong>AldÄ±ÄŸÄ±nÄ±z bal:</strong> ${result.score}/${currentQuestion.question_type === 'open_ended' ? currentQuestion.max_score : 1}</p>
                ${currentQuestion.explanation ? `
                    <div class="explanation">
                        <h5>ğŸ’¡ Ä°zah:</h5>
                        <p>${currentQuestion.explanation}</p>
                    </div>
                ` : ''}
                <p><strong>â±ï¸ Cavab mÃ¼ddÉ™ti:</strong> ${currentQuestion.time_limit - remainingTime} saniyÉ™</p>
            </div>
        </div>
    `;
    
    feedbackContainer.innerHTML = feedbackHTML;
    feedbackContainer.style.display = 'block';
}

// NÃ¶vbÉ™ti sual
function nextQuestion() {
    const formatSelect = document.getElementById('selected-format');
    const currentFormats = Object.keys(testQuestions);
    const currentIndex = currentFormats.indexOf(formatSelect.value);
    const nextIndex = currentIndex < currentFormats.length - 1 ? currentIndex + 1 : 0;
    
    formatSelect.value = currentFormats[nextIndex];
    
    // Timer sÄ±fÄ±rla
    timerActive = false;
    remainingTime = 0;
    currentQuestion = null;
    clearInterval(timerInterval);
    
    // UI tÉ™mizlÉ™
    document.getElementById('current-question').style.display = 'none';
    document.getElementById('answer-feedback').style.display = 'none';
    document.getElementById('timer-text').textContent = '--:--';
    
    updateTestInfo();
    
    showNotification('â¡ï¸ NÃ¶vbÉ™ti format Ã¼Ã§Ã¼n hazÄ±r! \'Testi BaÅŸlat\' basÄ±n.', 'info');
}

// NÉ™ticÉ™lÉ™r cÉ™dvÉ™lini yÃ¼klÉ™
function loadResultsTable() {
    const tableContainer = document.getElementById('results-table-container');
    const noResultsContainer = document.getElementById('no-results');
    
    if (testResults.length === 0) {
        if (tableContainer) tableContainer.style.display = 'none';
        if (noResultsContainer) noResultsContainer.style.display = 'block';
        return;
    }
    
    if (tableContainer) tableContainer.style.display = 'block';
    if (noResultsContainer) noResultsContainer.style.display = 'none';
    
    const tableBody = document.getElementById('results-table-body');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    testResults.forEach((result, index) => {
        const row = document.createElement('tr');
        
        const formatName = getFormatDisplayName(result.question_type);
        const resultIcon = result.is_correct ? 'âœ… DoÄŸru' : 'âŒ YanlÄ±ÅŸ';
        const scoreText = `${result.score}/${result.max_score}`;
        const timeText = `${result.response_time}s`;
        
        row.innerHTML = `
            <td>Q${result.question_id}</td>
            <td>${formatName}</td>
            <td>${result.topic}</td>
            <td>${'â­'.repeat(result.difficulty)}</td>
            <td class="${result.is_correct ? 'text-success' : 'text-danger'}">${resultIcon}</td>
            <td>${scoreText}</td>
            <td>${timeText}</td>
        `;
        
        tableBody.appendChild(row);
    });
}

// Format adÄ±nÄ± gÃ¶stÉ™rmÉ™k Ã¼Ã§Ã¼n
function getFormatDisplayName(questionType) {
    const formatNames = {
        'multiple_choice': 'ğŸ”˜ Ã‡oxlu SeÃ§im',
        'multiple_response': 'â˜‘ï¸ Ã‡oxlu Cavab',
        'true_false': 'âœ“/âœ— DoÄŸru/YanlÄ±ÅŸ',
        'open_ended': 'ğŸ“ AÃ§Ä±q CavablÄ±',
        'fill_blanks': 'ğŸ“„ BoÅŸluqlarÄ± Doldurun',
        'matching': 'ğŸ”— UyÄŸunlaÅŸdÄ±rma',
        'ordering': 'ğŸ”¢ SÄ±ralama'
    };
    return formatNames[questionType] || questionType;
}

// Value box-larÄ± yenilÉ™
function updateValueBoxes() {
    const totalQuestions = testResults.length;
    const correctAnswers = testResults.filter(result => result.is_correct).length;
    const successRate = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
    const averageScore = totalQuestions > 0 ? 
        Math.round(testResults.reduce((sum, result) => sum + result.score, 0) / totalQuestions * 10) / 10 : 0;
    
    // Total questions
    const totalElement = document.getElementById('total-questions-value');
    if (totalElement) totalElement.textContent = totalQuestions;
    
    // Success rate
    const successElement = document.getElementById('success-rate-value');
    if (successElement) {
        successElement.textContent = `${successRate}%`;
        const container = successElement.closest('.value-box');
        if (container) {
            container.className = `value-box ${successRate >= 80 ? 'success' : successRate >= 60 ? 'warning' : 'danger'}`;
        }
    }
    
    // Average score
    const avgElement = document.getElementById('average-score-value');
    if (avgElement) avgElement.textContent = averageScore;
}

// StatistikalarÄ± yenilÉ™
function updateStatistics() {
    updateDifficultyChart();
    updateFormatPieChart();
    updateUsageBarChart();
    updateDetailedAnalysis();
}

// Ã‡É™tinlik chartÄ±nÄ± yenilÉ™
function updateDifficultyChart() {
    const chartContainer = document.getElementById('difficulty-chart');
    if (!chartContainer) return;
    
    let difficultyData;
    if (testResults.length > 0) {
        // Real data
        const diffCounts = {};
        testResults.forEach(result => {
            const level = `SÉ™viyyÉ™ ${result.difficulty}`;
            diffCounts[level] = (diffCounts[level] || 0) + 1;
        });
        difficultyData = Object.keys(diffCounts).map(level => ({
            level: level,
            count: diffCounts[level]
        }));
    } else {
        // Demo data
        difficultyData = [
            {level: 'SÉ™viyyÉ™ 1', count: 2},
            {level: 'SÉ™viyyÉ™ 2', count: 3},
            {level: 'SÉ™viyyÉ™ 3', count: 1},
            {level: 'SÉ™viyyÉ™ 4', count: 1},
            {level: 'SÉ™viyyÉ™ 5', count: 0}
        ];
    }
    
    // Simple bar chart
    let chartHTML = '<div class="simple-chart">';
    difficultyData.forEach(item => {
        const barWidth = Math.max(item.count * 30, 10);
        chartHTML += `
            <div class="chart-bar">
                <div class="bar-label">${item.level}</div>
                <div class="bar-visual" style="width: ${barWidth}px; background: linear-gradient(90deg, #667eea, #764ba2);">
                    <span class="bar-value">${item.count}</span>
                </div>
            </div>
        `;
    });
    chartHTML += '</div>';
    
    chartContainer.innerHTML = `
        <h4>â­ Ã‡É™tinlik SÉ™viyyÉ™sinÉ™ GÃ¶rÉ™ Suallar</h4>
        ${chartHTML}
    `;
}

// Format pie chart yenilÉ™
function updateFormatPieChart() {
    const chartContainer = document.getElementById('format-pie-chart');
    if (!chartContainer) return;
    
    const formatData = [
        {name: 'Ã‡oxlu SeÃ§im', percent: 45, emoji: 'ğŸ”˜', color: '#FF6B6B'},
        {name: 'Ã‡oxlu Cavab', percent: 20, emoji: 'â˜‘ï¸', color: '#4ECDC4'},
        {name: 'DoÄŸru/YanlÄ±ÅŸ', percent: 15, emoji: 'âœ“/âœ—', color: '#45B7D1'},
        {name: 'AÃ§Ä±q CavablÄ±', percent: 10, emoji: 'ğŸ“', color: '#96CEB4'},
        {name: 'BoÅŸluq', percent: 5, emoji: 'ğŸ“„', color: '#FECA57'},
        {name: 'UyÄŸunlaÅŸdÄ±rma', percent: 3, emoji: 'ğŸ”—', color: '#FF9FF3'},
        {name: 'SÄ±ralama', percent: 2, emoji: 'ğŸ”¢', color: '#54A0FF'}
    ];
    
    let chartHTML = '<div class="pie-chart-container">';
    chartHTML += '<h4>ğŸ¥§ Test FormatlarÄ±nÄ±n PaylanmasÄ±</h4>';
    chartHTML += '<div class="pie-chart-legend">';
    
    formatData.forEach(item => {
        chartHTML += `
            <div class="legend-item">
                <div class="legend-color" style="background-color: ${item.color};"></div>
                <span>${item.emoji} ${item.name}: ${item.percent}%</span>
            </div>
        `;
    });
    
    chartHTML += '</div></div>';
    chartContainer.innerHTML = chartHTML;
}

// Usage bar chart yenilÉ™
function updateUsageBarChart() {
    const chartContainer = document.getElementById('usage-bar-chart');
    if (!chartContainer) return;
    
    const usageData = Object.keys(testQuestions).map(key => ({
        format: testQuestions[key].title,
        percent: testQuestions[key].usage_percent
    })).sort((a, b) => b.percent - a.percent);
    
    let chartHTML = '<div class="usage-chart">';
    chartHTML += '<h4>ğŸ“Š Test FormatlarÄ±nÄ±n Ä°stifadÉ™ Tezliyi</h4>';
    
    usageData.forEach(item => {
        const barWidth = (item.percent / 50) * 100; // 50% maximum width
        chartHTML += `
            <div class="usage-bar">
                <div class="usage-label">${item.format}</div>
                <div class="usage-bar-container">
                    <div class="usage-bar-fill" style="width: ${barWidth}%"></div>
                    <span class="usage-percent">${item.percent}%</span>
                </div>
            </div>
        `;
    });
    
    chartHTML += '</div>';
    chartContainer.innerHTML = chartHTML;
}

// ÆtraflÄ± analiz yenilÉ™
function updateDetailedAnalysis() {
    const analysisContainer = document.getElementById('detailed-analysis');
    if (!analysisContainer) return;
    
    let analysisText = '';
    
    if (testResults.length > 0) {
        const totalQuestions = testResults.length;
        const correctAnswers = testResults.filter(result => result.is_correct).length;
        const successRate = Math.round((correctAnswers / totalQuestions) * 100);
        const avgScore = Math.round(testResults.reduce((sum, result) => sum + result.score, 0) / totalQuestions * 100) / 100;
        const avgTime = Math.round(testResults.reduce((sum, result) => sum + result.response_time, 0) / totalQuestions);
        
        analysisText = `
ğŸ¯ === ÅÆXSÄ° TEST NÆTÄ°CÆLÆRÄ° ===

ğŸ“Š Ãœmumi statistika:
   â€¢ Ãœmumi sual sayÄ±: ${totalQuestions}
   â€¢ DoÄŸru cavablar: ${correctAnswers} (${successRate}%)
   â€¢ Orta bal: ${avgScore}
   â€¢ Orta cavab mÃ¼ddÉ™ti: ${avgTime} saniyÉ™

ğŸ† === PERFORMANs QÄ°YMÆTLÆNDÄ°RMÆSÄ° ===
${successRate >= 90 ? 'ğŸ¥‡ ÆLAHÆZRÆT! Siz test formatlarÄ±nda ustadsÄ±nÄ±z!' : 
  successRate >= 80 ? 'ğŸ¥ˆ ÆLA! Ã‡ox yaxÅŸÄ± nÉ™ticÉ™ gÃ¶stÉ™rdiniz.' : 
  successRate >= 70 ? 'ğŸ¥‰ YAXÅI! Daha Ã§ox tÉ™crÃ¼bÉ™ ilÉ™ daha da yaxÅŸÄ±laÅŸacaq.' : 
  successRate >= 60 ? 'ğŸ“ˆ ORTA! ÆlavÉ™ tÉ™crÃ¼bÉ™ tÃ¶vsiyÉ™ olunur.' : 
  'ğŸ“š BAÅLANÄIC! Narahat olmayÄ±n, hÉ™r kÉ™s Ã¶yrÉ™nmÉ™klÉ™ baÅŸlayÄ±r.'}

ğŸ’¡ === TOVSÄ°YÆLÆR ===
ğŸ¯ GÃ¼clÃ¼ tÉ™rÉ™flÉ™riniz:
${successRate >= 80 ? '   â€¢ Test formatlarÄ±nÄ± yaxÅŸÄ± anlayÄ±rsÄ±nÄ±z' : '   â€¢ Ã–yrÉ™nmÉ™yÉ™ hÉ™vÉ™slisiniz'}
   â€¢ MÃ¼xtÉ™lif sual tiplÉ™rini sÄ±naqdan keÃ§irdiniz

ğŸ”„ TÉ™kmillÉ™ÅŸdirmÉ™ sahÉ™lÉ™ri:
${successRate < 80 ? '   â€¢ Daha Ã§ox mÃ¼xtÉ™lif format nÃ¶vlÉ™rini sÄ±nayÄ±n' : ''}
${avgTime > 60 ? '   â€¢ Cavab vermÉ™ sÃ¼rÉ™tinizi artÄ±rÄ±n' : ''}
   â€¢ AÃ§Ä±q cavablÄ± suallar Ã¼Ã§Ã¼n aÃ§ar sÃ¶zlÉ™rÉ™ diqqÉ™t edin
        `;
    } else {
        analysisText = `
ğŸ“‹ === TEST FORMATLARININ ÆTRAYLI ANALÄ°ZÄ° ===

ğŸ¯ FORMATLARIN XÃœSUSÄ°YYÆTLÆRÄ°:

1ï¸âƒ£ Ã‡OXLU SEÃ‡Ä°M (Multiple Choice) - 45% istifadÉ™
   ğŸ”¸ ÃœstÃ¼nlÃ¼klÉ™ri:
     â€¢ Avtomatik qiymÉ™tlÉ™ndirmÉ™
     â€¢ Obyektiv nÉ™ticÉ™lÉ™r
     â€¢ BÃ¶yÃ¼k qruplar Ã¼Ã§Ã¼n É™lveriÅŸli
     â€¢ SÃ¼rÉ™tli test keÃ§irmÉ™
   ğŸ”¸ Ã‡atÄ±ÅŸmazlÄ±qlarÄ±:
     â€¢ TÉ™sadÃ¼fi cavab riski (25% 4 variantda)
     â€¢ YaradÄ±cÄ± dÃ¼ÅŸÃ¼ncÉ™ni mÉ™hdudlaÅŸdÄ±rÄ±r
     â€¢ YalnÄ±z tanÄ±ma sÉ™viyyÉ™sindÉ™ yoxlayÄ±r

2ï¸âƒ£ Ã‡OXLU CAVAB (Multiple Response) - 20% istifadÉ™
   ğŸ”¸ ÃœstÃ¼nlÃ¼klÉ™ri:
     â€¢ Daha dÉ™qiq bilik Ã¶lÃ§Ã¼mÃ¼
     â€¢ QismÉ™n bal verilÉ™ bilÉ™r
     â€¢ TÉ™sadÃ¼fi cavab ÅŸansÄ± azdÄ±r
   ğŸ”¸ Ã‡atÄ±ÅŸmazlÄ±qlarÄ±:
     â€¢ MÃ¼rÉ™kkÉ™b qiymÉ™tlÉ™ndirmÉ™
     â€¢ ÅagirdlÉ™r Ã¼Ã§Ã¼n Ã§aÅŸdÄ±rÄ±cÄ± ola bilÉ™r

3ï¸âƒ£ DOÄRU/YANLIÅ (True/False) - 15% istifadÉ™
   ğŸ”¸ ÃœstÃ¼nlÃ¼klÉ™ri:
     â€¢ Ã‡ox sÃ¼rÉ™tli
     â€¢ SadÉ™ qiymÉ™tlÉ™ndirmÉ™
     â€¢ Ã‡ox sual sormaq mÃ¼mkÃ¼n
   ğŸ”¸ Ã‡atÄ±ÅŸmazlÄ±qlarÄ±:
     â€¢ 50% tÉ™sadÃ¼fi doÄŸru cavab ÅŸansÄ±
     â€¢ YÃ¼zeysel bilik yoxlamasÄ±

ğŸ“Š OPTIMAL TEST KOMPOZÄ°SÄ°YASI:
â€¢ 60% Ã‡oxlu seÃ§im (É™sas bilik)
â€¢ 20% Ã‡oxlu cavab (É™laqÉ™lÉ™r)
â€¢ 15% DoÄŸru/YanlÄ±ÅŸ (faktlar)
â€¢ 5% AÃ§Ä±q cavablÄ± (dÉ™rin anlayÄ±ÅŸ)
        `;
    }
    
    analysisContainer.innerHTML = `<pre>${analysisText}</pre>`;
}

// NÉ™ticÉ™lÉ™ri yÃ¼klÉ™
function downloadResults() {
    if (testResults.length === 0) {
        showNotification('âš ï¸ YÃ¼klÉ™mÉ™k Ã¼Ã§Ã¼n test nÉ™ticÉ™si yoxdur!', 'warning');
        return;
    }
    
    const csvContent = convertToCSV(testResults);
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    
    if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `test_results_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification('ğŸ“¥ NÉ™ticÉ™lÉ™r uÄŸurla yÃ¼klÉ™ndi!', 'success');
    }
}

// CSV-yÉ™ Ã§evir
function convertToCSV(data) {
    const headers = ['Sual ID', 'Sual MÉ™tnii', 'Format', 'MÃ¶vzu', 'Ã‡É™tinlik', 'Ä°stifadÉ™Ã§i CavabÄ±', 'DÃ¼zgÃ¼n Cavab', 'DoÄŸru?', 'Bal', 'Max Bal', 'Vaxt', 'Tarix'];
    
    const csvRows = [headers.join(',')];
    
    data.forEach(result => {
        const row = [
            result.question_id,
            `"${result.question_text.replace(/"/g, '""')}"`,
            `"${getFormatDisplayName(result.question_type)}"`,
            `"${result.topic}"`,
            result.difficulty,
            `"${result.user_answer.replace(/"/g, '""')}"`,
            `"${result.correct_answer.replace(/"/g, '""')}"`,
            result.is_correct ? 'BÉ™li' : 'Xeyr',
            result.score,
            result.max_score,
            result.response_time,
            result.timestamp
        ];
        csvRows.push(row.join(','));
    });
    
    return csvRows.join('\n');
}

// BildiriÅŸ gÃ¶stÉ™r
function showNotification(message, type = 'info', duration = 4000) {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    // Notification container yarat vÉ™ ya mÃ¶vcud olanÄ± tap
    let container = document.getElementById('notification-container');
    if (!container) {
        container = document.createElement('div');
        container.id = 'notification-container';
        container.className = 'notification-container';
        document.body.appendChild(container);
    }
    
    container.appendChild(notification);
    
    // Animasiya
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // Auto remove
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, duration);
}

// Page load event
window.addEventListener('load', function() {
    // ÆlavÉ™ yÃ¼klÉ™mÉ™ É™mÉ™liyyatlarÄ±
    console.log('Test TapÅŸÄ±rÄ±qlarÄ± FormatlarÄ± tÉ™tbiqi yÃ¼klÉ™ndi!');
});
